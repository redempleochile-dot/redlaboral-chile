<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestionar Candidatos | EmpleosChile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-5">
        <a href="/mis-avisos/" class="btn btn-outline-secondary mb-4">â† Volver a Mis Ofertas</a>
        <div class="card shadow-sm mb-4"><div class="card-body"><h2 class="mb-0">ğŸ‘¥ Postulantes para: <strong>{{ oferta.titulo }}</strong></h2><p class="text-muted">Gestiona el estado de tus candidatos.</p></div></div>
        <div class="row">
            {% for post in postulaciones %}
            <div class="col-md-6 mb-3">
                <div class="card h-100 border-0 shadow-sm {% if post.estado == 'NO' %}bg-secondary bg-opacity-10{% elif post.estado == 'INT' %}border-start border-5 border-success{% endif %}">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            {% if post.candidato.foto %}<img src="{{ post.candidato.foto.url }}" class="rounded-circle me-3" width="50" height="50" style="object-fit: cover;">{% else %}<div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">ğŸ‘¤</div>{% endif %}
                            <div><h5 class="mb-0"><a href="/candidato/{{ post.candidato.id }}/" target="_blank" class="text-decoration-none">{{ post.candidato.nombre }}</a></h5><small class="text-muted">{{ post.candidato.titular }}</small></div>
                            <div class="ms-auto"><span class="badge {% if post.estado == 'ENV' %}bg-primary{% elif post.estado == 'VIS' %}bg-info{% elif post.estado == 'INT' %}bg-success{% else %}bg-secondary{% endif %}">{{ post.get_estado_display }}</span></div>
                        </div>
                        <div class="bg-white p-2 rounded border mb-3"><small class="text-muted fw-bold">Datos de contacto:</small><br>ğŸ“§ {{ post.candidato.email }}<br>ğŸ“± {{ post.candidato.telefono }}</div>
                        <div class="d-flex justify-content-between align-items-center">
                            <a href="/candidato/{{ post.candidato.id }}/descargar/" class="btn btn-sm btn-outline-dark">ğŸ“„ Descargar CV</a>
                            <form method="post" class="d-flex gap-1">{% csrf_token %}<input type="hidden" name="postulacion_id" value="{{ post.id }}"><button type="submit" name="nuevo_estado" value="VIS" class="btn btn-sm btn-light border" title="Marcar Visto">ğŸ‘€</button><button type="submit" name="nuevo_estado" value="INT" class="btn btn-sm btn-success" title="Entrevista">ğŸ¤</button><button type="submit" name="nuevo_estado" value="NO" class="btn btn-sm btn-danger" title="Descartar">âŒ</button></form>
                        </div>
                        <small class="text-muted mt-2 d-block text-end" style="font-size: 0.7rem;">PostulÃ³: {{ post.fecha|date:"d M Y H:i" }}</small>
                    </div>
                </div>
            </div>
            {% empty %}
                <div class="col-12 text-center py-5"><h4>ğŸ“­ AÃºn no hay postulantes</h4><p class="text-muted">Comparte tu oferta para recibir candidatos.</p></div>
            {% endfor %}
        </div>
    </div>
</body>
</html>